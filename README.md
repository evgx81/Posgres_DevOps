# О программе
Программа предназначена для решения следующей задачи:


Реализовать консольное приложение, которое будет устанавливать PostgreSQL на удаленный хост, настраивать и запускать.

Вводные: 2 сервера, один на Debian, второй на CentOS (AlmaLinux). На обоих серверах пользователю root подложен один и тот же открытый ssh ключ. У исполнителя есть закрытая часть ключа, с помощью которой он подключается.

---

Реализация должна включать:
* подключение к удаленным хостам по ssh
* оценку загруженности серверов, выбор наименее нагруженного из серверов как целевого
* инсталляцию PostgreSQL на целевой хост
* настройку PostgreSQL для приема внешних соединений, т.е. БД должна отвечать на sql-запросы с внешних ip-адресов
* настройку подключения пользователя “student” к PostgreSql только с ip адреса второго сервера.

Требования
* приложение принимает один строковый параметр - ip адреса или имена серверов одной строкой, разделитель - запятая
* приложение должно сообщать статус выполнения инсталляции
  
Будет плюсом
* приложение выполняет проверку работы БД, выполняя sql запрос (SELECT 1)

Требования к коду
* язык разработки: bash, python, ansible 
* библиотеки можно использовать любые
* код должен быть выложен на Github с Readme файлом с инструкцией по запуску и примерами. Важно, чтобы по инструкции можно было запустить код и он работал
* при возникновении вопросов по ТЗ оставляем принятие решения за тобой.
  
Желательно отразить в Readme, какие вопросы возникали и какие решения были приняты

# Установка

Программу можно установить с помощью `pip`, предварительно создав и активировав виртуальное окружение:

```bash
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

Программу можно также установить с помощью пакетного менеджера `uv`:

```bash
uv init
uv pip install -r requirements.txt
```

# Запуск

Для запуска программы с помощью `pip` нужно активировать виртуальное окружение и запустить скрипт:

```bash
python devops_test_task.py -s список_серверов
```

Для запуска программы с помощью `uv` нужно выполнить команду:

```bash
uv run devops_test_task.py -s список_серверов
```

# Вопросы, которые возникали во время разработки

1. Какой инструмент выбрать для реализации поставленной задачи?

    Проанализировав инструменты, предложенных в постановке задачи, было принято решение использовать язык программирования Python. Он представляет
    собой простой скриптовый язык и позволяет не отвлекаться на такие моменты, как типизация, работа с памятью и т. д.

1. Какие библиотеки нужно использовать для подключения к удаленному серверу на языке программрования Python?

    Для подключения к удаленному серверу на языке программрования Python существуют различные библиотеки, такие как `paramiko`, `fabric` и `pywinrm`.
    Для решения задачи мне показалась библиотека `paramiko` более удобной, поэтому я использовала ее в данном проекте. 

1. Как измерить загруженность сервера на операционных системах, перечисленных в условии задачи?

    Для оценки загруженности сервера можно использовать различные подходы. Например, можно измерять загруженность процессора, памяти, дисковой подсистемы и т. п.
    Исходя из условий задачи, которые мной были поняты так, что нужно развернуть тестовый стенд на наименее загруженном сервере, было принято решение измерять загруженность сервера по текущей загруженности процессора. Для этого можно использовалась команда: 
    ```bash
    top -b -n 1 | grep "Cpu(s)" | awk '{print $2}'  
    ```
    Также можно использовать команду `uptime`, однако она выводит загруженность процессора, не учитывая его многоядерности.

1. Как определить версию операционной системы?

    Для определения версии операционной системы можно использовать команду 
    ```bash
    cat /etc/os-release,
    ``` 
    которая выведет все параметры операционной системы.

1. Как установить PostgreSQL?

    Для установки PostgreSQL на Debian был выбран вариант установки из стандартного репозитория, т.к. в нем содержится довольно актуальная версия PostgreSQL. Однако, для установки на AlmaLinux такой вариант не подходит, т.к. в стандартном репозитории содержится старая версия PostgreSQL (13), поэтому был выбран вариант установки, предложенный на сайте PostgreSQL https://www.postgresql.org/download/linux/redhat/.
